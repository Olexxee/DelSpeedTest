<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Internet Speed Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <script>
        tailwind.config = {
            darkMode: 'class',
        };
    </script>

    <style>
        @keyframes sparkle {

            0%,
            95%,
            100% {
                text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
                transform: rotate(0deg) scale(1);
            }

            50% {
                text-shadow: 0 0 18px rgba(255, 255, 255, 0.9),
                    0 0 30px rgba(0, 230, 230, 0.6);
                transform: rotate(5deg) scale(1.2);
            }
        }

        .sparkle {
            animation: sparkle 6s infinite;
        }
    </style>
</head>

<body
    class="min-h-screen bg-gradient-to-br from-indigo-500 to-purple-700 dark:from-gray-900 dark:to-black flex flex-col items-center p-5 text-white transition-colors">

    <!-- Header -->
    <div class="w-full max-w-6xl flex justify-between items-center mb-6">
        <h2 class="flex items-center gap-3 text-xl sm:text-2xl font-bold">
            <i
                class="fa fa-diamond sparkle text-transparent bg-clip-text bg-gradient-to-r from-teal-400 via-purple-400 to-pink-500"></i>
            DIAMOND EFOOTBALL NETWORK SPEED TEST
        </h2>
        <button id="themeToggle"
            class="px-3 py-2 rounded-full bg-white/20 hover:bg-white/30 text-sm font-semibold flex items-center gap-2 transition">
            <i class="fas fa-moon"></i> <span>Dark</span>
        </button>
    </div>

    <!-- Main Container -->
    <div class="w-full max-w-6xl grid grid-cols-1 lg:grid-cols-2 gap-6">

        <!-- Left Panel -->
        <div
            class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 shadow-lg border border-white/20 dark:bg-gray-800/50 dark:border-gray-700">
            <h1 class="text-2xl font-light text-center mb-6">Speed Test</h1>

            <div class="flex justify-around mb-6">
                <div class="text-center">
                    <div class="uppercase text-sm opacity-80 mb-1">Download</div>
                    <div id="downloadSpeed" class="text-3xl font-bold">--</div>
                    <div class="text-sm opacity-70">Mbps</div>
                    <div id="downloadBadge" class="mt-2"></div>
                </div>
                <div class="text-center">
                    <div class="uppercase text-sm opacity-80 mb-1">Upload</div>
                    <div id="uploadSpeed" class="text-3xl font-bold">--</div>
                    <div class="text-sm opacity-70">Mbps</div>
                    <div id="uploadBadge" class="mt-2"></div>
                </div>
            </div>

            <!-- Progress bar -->
            <div class="w-full bg-white/20 h-2 rounded mb-3">
                <div id="progressFill"
                    class="bg-gradient-to-r from-teal-400 to-cyan-400 h-2 rounded w-0 transition-all"></div>
            </div>

            <div id="status" class="text-center text-sm opacity-90 min-h-[20px] mb-2">
                Click "Start Test" to begin
            </div>

            <button id="startTest" onclick="runSpeedTest()"
                class="w-full py-3 rounded-full bg-gradient-to-r from-rose-500 to-amber-400 text-white font-semibold tracking-wide uppercase text-sm hover:shadow-lg transition">
                Start Test
            </button>

            <div id="pingDisplay" class="text-center text-sm opacity-80 mt-3"></div>
        </div>

        <!-- Right Panel -->
        <div
            class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 shadow-lg border border-white/20 dark:bg-gray-800/50 dark:border-gray-700">
            <h2 class="text-xl font-semibold text-center mb-6">Signal Strength</h2>

            <div class="space-y-5">
                <div class="flex items-center gap-3">
                    <i class="fas fa-gamepad text-xl"></i>
                    <div id="gamingBars" class="flex gap-1 flex-1 items-end h-5"></div>
                </div>
                <div class="flex items-center gap-3">
                    <i class="fas fa-tv text-xl"></i>
                    <div id="streamingBars" class="flex gap-1 flex-1 items-end h-5"></div>
                </div>
                <div class="flex items-center gap-3">
                    <i class="fas fa-video text-xl"></i>
                    <div id="callsBars" class="flex gap-1 flex-1 items-end h-5"></div>
                </div>
                <div class="flex items-center gap-3">
                    <i class="fas fa-globe text-xl"></i>
                    <div id="browsingBars" class="flex gap-1 flex-1 items-end h-5"></div>
                </div>
            </div>

            <!-- WhatsApp CTA -->
            <div class="mt-8 text-center">
                <p class="mb-3">Join our WhatsApp group for competitive tournaments!</p>
                <a href="https://chat.whatsapp.com/Bs75urxsdCBDGnhpF7fOn9" target="_blank"
                    class="inline-flex items-center gap-2 bg-green-500 px-5 py-2 rounded-full text-white font-bold hover:bg-green-600 transition">
                    <i class="fab fa-whatsapp text-lg"></i> Join Group
                </a>
            </div>
        </div>
    </div>

    <script>
        // Dark/Light Toggle with persistence
        const themeBtn = document.getElementById('themeToggle');
        const html = document.documentElement;

        function setTheme(mode) {
            if (mode === 'dark') {
                html.classList.add('dark');
                themeBtn.querySelector('i').classList.replace('fa-sun', 'fa-moon');
                themeBtn.querySelector('span').textContent = 'Dark';
                localStorage.setItem('theme', 'dark');
            } else {
                html.classList.remove('dark');
                themeBtn.querySelector('i').classList.replace('fa-moon', 'fa-sun');
                themeBtn.querySelector('span').textContent = 'Light';
                localStorage.setItem('theme', 'light');
            }
        }

        // Load theme from localStorage
        const savedTheme = localStorage.getItem('theme') || 'dark';
        setTheme(savedTheme);

        themeBtn.addEventListener('click', () => {
            if (html.classList.contains('dark')) {
                setTheme('light');
            } else {
                setTheme('dark');
            }
        });

        // Speed Test Functions
        let isTestRunning = false;

        const updateProgress = (pct) => {
            document.getElementById('progressFill').style.width = pct + '%';
        };

        const updateStatus = (msg) => {
            document.getElementById('status').textContent = msg;
        };

        const setBadge = (value, type) => {
            let badgeClass = 'bg-red-500/20 text-red-400';
            let label = 'Poor';

            if (type === 'download') {
                if (value >= 50) { badgeClass = 'bg-green-500/20 text-green-400'; label = 'Good'; }
                else if (value >= 20) { badgeClass = 'bg-yellow-500/20 text-yellow-400'; label = 'Average'; }
            }

            if (type === 'upload') {
                if (value >= 10) { badgeClass = 'bg-green-500/20 text-green-400'; label = 'Good'; }
                else if (value >= 3) { badgeClass = 'bg-yellow-500/20 text-yellow-400'; label = 'Average'; }
            }

            document.getElementById(type + 'Badge').innerHTML =
                `<span class="px-3 py-1 rounded-full text-xs font-bold ${badgeClass}">${label}</span>`;
        };

        const createBars = (containerId, strength) => {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            for (let i = 1; i <= 5; i++) {
                const bar = document.createElement('div');
                bar.className = 'flex-1 rounded bg-white/20 transition-all';
                bar.style.height = (i * 20) + '%';
                if (i <= strength) {
                    bar.style.background = '#00ff95';
                }
                container.appendChild(bar);
            }
        };

        const updateSignalStrength = (download, upload, ping) => {
            const gaming = ping < 40 ? 5 : ping < 80 ? 3 : 1;
            const streaming = download > 50 ? 5 : download > 20 ? 3 : 1;
            const calls = upload > 10 ? 5 : upload > 3 ? 3 : 1;
            const browsing = (download + upload) / 2 > 30 ? 5 : 3;

            createBars('gamingBars', gaming);
            createBars('streamingBars', streaming);
            createBars('callsBars', calls);
            createBars('browsingBars', browsing);
        };

        async function testPing() {
            const start = performance.now();
            try {
                await fetch('https://speed.cloudflare.com/__down?bytes=1000', { cache: 'no-cache' });
                const end = performance.now();
                return Math.round(end - start);
            } catch {
                return null;
            }
        }

        async function testDownloadSpeed() {
            updateStatus('Testing download speed...');
            updateProgress(25);

            const sizes = [1e6, 1e7];
            let total = 0, ok = 0;

            for (let i = 0; i < sizes.length; i++) {
                try {
                    const start = performance.now();
                    const res = await fetch(`https://speed.cloudflare.com/__down?bytes=${sizes[i]}`, { cache: 'no-cache' });
                    await res.blob();
                    const end = performance.now();
                    const duration = (end - start) / 1000;
                    const speed = (sizes[i] * 8 / duration) / 1e6;
                    total += speed; ok++;
                    updateProgress(25 + (i + 1) * 20);
                } catch { }
            }

            if (ok) return total / ok;
            throw new Error('Download test failed');
        }

        async function testUploadSpeed() {
            updateStatus('Testing upload speed...');
            updateProgress(70);

            const totalSize = 1e6;
            const chunkSize = 65536;
            const data = new Uint8Array(totalSize);
            for (let offset = 0; offset < totalSize; offset += chunkSize) {
                const len = Math.min(chunkSize, totalSize - offset);
                const temp = new Uint8Array(len);
                crypto.getRandomValues(temp);
                data.set(temp, offset);
            }

            const start = performance.now();
            await fetch('https://speed.cloudflare.com/__up', { method: 'POST', body: data });
            const end = performance.now();
            const duration = (end - start) / 1000;
            return (data.length * 8 / duration) / 1e6;
        }

        async function runSpeedTest() {
            if (isTestRunning) return;
            isTestRunning = true;
            const btn = document.getElementById('startTest');
            btn.disabled = true;
            btn.textContent = 'Testing...';

            try {
                updateStatus('Testing ping...');
                const ping = await testPing();
                document.getElementById('pingDisplay').textContent = ping ? `Ping: ${ping}ms` : 'Ping: Error';
                updateProgress(10);

                const download = await testDownloadSpeed();
                document.getElementById('downloadSpeed').textContent = download.toFixed(1);
                setBadge(download, 'download');

                const upload = await testUploadSpeed();
                document.getElementById('uploadSpeed').textContent = upload.toFixed(1);
                setBadge(upload, 'upload');

                updateSignalStrength(download, upload, ping);
                updateProgress(100);
                updateStatus('Test completed!');
            } catch (err) {
                updateStatus('Test failed. Please try again.');
            } finally {
                isTestRunning = false;
                btn.disabled = false;
                btn.textContent = 'Start Test';
            }
        }
    </script>
</body>

</html>